<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dealer Submission Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f0f4f8; /* Light blue-gray background */
        }
        .form-container {
            background-color: #ffffff;
            border-radius: 1rem;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
            padding: 2rem;
        }
        .form-input, .form-button {
            transition: all 0.3s ease;
        }
        .form-input:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.5);
        }
        .form-button {
            background-color: #2563eb;
            color: #ffffff;
        }
        .form-button:hover {
            background-color: #1d4ed8;
            transform: translateY(-2px);
        }
        .form-label {
            color: #1e3a8a;
            font-weight: 600;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="form-container w-full max-w-2xl">
        <h1 class="text-3xl font-bold text-center text-blue-900 mb-8">Dealer Submission Portal</h1>

        <form id="submissionForm" class="space-y-6">
            <div>
                <label for="dealerName" class="form-label block text-sm">Dealer Name</label>
                <input type="text" id="dealerName" name="dealerName" required
                       class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="marketingPersonName" class="form-label block text-sm">Marketing Person Name</label>
                <input type="text" id="marketingPersonName" name="marketingPersonName" required
                       class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="dealerLocation" class="form-label block text-sm">Dealer Location</label>
                <input type="text" id="dealerLocation" name="dealerLocation" required
                       class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 focus:ring-2 focus:ring-blue-500">
            </div>

            <div>
                <label for="fileUpload" class="form-label block text-sm">File Upload (Multiple files)</label>
                <input type="file" id="fileUpload" name="fileUpload" multiple required
                       class="form-input mt-1 block w-full rounded-md border-gray-300 shadow-sm p-3 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
            </div>
            
            <div id="loadingMessage" class="hidden text-center text-blue-600 font-semibold">
                Submitting... Please wait.
            </div>

            <div id="statusMessage" class="text-center font-medium mt-4"></div>

            <button type="submit" id="submitButton"
                    class="form-button w-full py-3 px-4 rounded-md font-semibold text-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                Submit
            </button>
        </form>
    </div>

    <script>
        document.getElementById('submissionForm').addEventListener('submit', async function(event) {
            event.preventDefault();

            const form = event.target;
            const submitButton = document.getElementById('submitButton');
            const loadingMessage = document.getElementById('loadingMessage');
            const statusMessage = document.getElementById('statusMessage');

            submitButton.disabled = true;
            submitButton.style.opacity = 0.5;
            loadingMessage.classList.remove('hidden');
            statusMessage.textContent = '';

            const dealerName = form.dealerName.value;
            const marketingPersonName = form.marketingPersonName.value;
            const dealerLocation = form.dealerLocation.value;
            const files = form.fileUpload.files;

            const filesData = [];
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                const reader = new FileReader();
                reader.readAsDataURL(file);
                await new Promise(resolve => {
                    reader.onloadend = () => {
                        filesData.push({
                            name: file.name,
                            data: reader.result.split(',')[1] // Get base64 data
                        });
                        resolve();
                    };
                });
            }

            const formData = {
                dealerName: dealerName,
                marketingPersonName: marketingPersonName,
                dealerLocation: dealerLocation,
                files: filesData
            };

            const url = 'https://script.google.com/macros/s/AKfycbxaVH3iboYQeFVYp_iFLGUYOtuVvD2sRDFIIorp8uy_QfP3V6D1E1v1iodONuyHPbgB/exec';

            try {
                const response = await fetch(url, {
                    method: 'POST',
                    mode: 'no-cors', // Use 'no-cors' to avoid CORS issues with simple POST
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData),
                });
                // Since we use no-cors, we can't check response.ok, so we just assume success for a 200 range status
                statusMessage.textContent = '✅ Submission successful!';
                statusMessage.className = 'text-center font-medium mt-4 text-green-600';
                form.reset();
            } catch (error) {
                console.error('Error:', error);
                statusMessage.textContent = '❌ An error occurred. Please try again.';
                statusMessage.className = 'text-center font-medium mt-4 text-red-600';
            } finally {
                submitButton.disabled = false;
                submitButton.style.opacity = 1;
                loadingMessage.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
